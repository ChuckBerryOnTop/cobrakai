<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js'></script>
    <style>
        #snap {
            float: right;
        }
    </style>
    
</head>
<body onload="init()">
    
    <div id="container">
        <video autoplay="true" id="videoElement">
         
        </video>
    </div>
    <canvas  id="myCanvas" width="400" height="350"></canvas>
    
    <button id="snap" onclick="snapshot()">Snapshot</button>

    <button id="cam" onclick="startCam()">Camera</button>

    <button id="close" onclick="closeCam()">Close</button>

    <!--<iframe id="frame" src=""></iframe>-->
    <script>
var vid = document.querySelector("#videoElement");

//const mediaSource = new MediaSource();
//vid.src = mediaSource
function startCam() {
    if (navigator.webkitGetUserMedia!=null) {

        var options = { 
            video:true, 
            audio:false 
        };  
        navigator.webkitGetUserMedia(options, 
            function(stream) { 
            vid.src = window.webkitURL.createObjectURL(stream);
            //vid.src = window.URL.HTMLMediaElement.srcObject
            //const mediaSource = new MediaSource();
            //vid.src = stream
            //vid.src = mediaSource;
            
            localstream = stream;
            vid.play();
            console.log("streaming");
        }, 
            function(e) { 
                console.log("background error : " + e);
            }); 
    } 
}

function closeCam() {
    console.log('close');
    vid.pause();
    /*let stream = vid.srcObject;
    let tracks = stream.getTracks();

    tracks.forEach(function(track) {
        track.stop();
    });

  videoElem.srcObject = null;*/

}
 //---------------------
      // TAKE A SNAPSHOT CODE
      //---------------------
var canvas, ctx;

function init() {
    // Get the canvas and obtain a context for
    // drawing in it
    canvas = document.getElementById("myCanvas");
    ctx = canvas.getContext('2d');
}

function snapshot() {    
    ctx.drawImage(vid, 0,0, canvas.width, canvas.height);   
    canvas = document.getElementById("myCanvas");
    ctx = canvas.getContext('2d');        
    dataURL = canvas.toDataURL('image/png');      
    //console.log("URL: "+dataURL);
    //console.log(dataURL);
    const dataSent = {
        key: dataURL
    }
    $.post("/api/logo", dataSent)
        .then(function(data) {
            console.log("image sent");
        });        
}
           
    </script>
</body>
</html>